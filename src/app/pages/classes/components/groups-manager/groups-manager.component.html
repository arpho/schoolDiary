<div class="groups-container">
  <h3>Gestione Gruppi</h3>
  
  @if (!classkey()) {
    <div class="alert alert-warning">
      Nessuna classe selezionata
    </div>
  } @else {
      
      @if (groupsList().length > 0) {
        <h4>Gruppi disponibili:</h4>
        <ul>

        </ul>
      } @else {
        <p>Nessun gruppo trovato per questa classe.</p>
      }
  <ion-button (click)="addGroup()">Crea Gruppo<ion-icon name="medkit"></ion-icon></ion-button>
  <div >
    <div>
      <p>Classe: <strong>{{classe()?.classe}}</strong></p>
      <div class="content-wrapper">
        <div class="students-container">
          <p>Studenti: <strong>{{availableStudents().length}}</strong></p>
          <div class="drag-container" id="studentslist">
            <h4>Studenti disponibili</h4>



            <ion-searchbar 
            placeholder="Cerca studenti..."
            [debounce]="300"
            (ionInput)="onSearchInput($event)">
          </ion-searchbar>






            <div
              cdkDropList
              id="studentslist"
              #studentslist="cdkDropList"
              [cdkDropListData]="availableStudents()"
              class="drop-list"
              [cdkDropListConnectedTo]="connectedLists()"
              (cdkDropListDropped)="drop($event,'')">
              @for (student of availableStudents().filter(filterStudents()); track student.key) {
                @if(student.firstName && student.lastName) {
                <div class="drag-item" cdkDrag
                [ngClass]="highlightstudent(student)"
                [cdkDragData]="student"
                >
                  {{ student.lastName }} {{ student.firstName }}
                </div>
                }
              }
            </div>
          </div>
        </div>

        <div class="groups-container">
          <h4>Gruppi</h4>
          <div id="groupslist">
            @for(group of groupsList(); track group.key) {
              <div class="group-item"
              (click)="editGroup(group)"
              id="{{groupidfactory(group)}}"
     cdkDropList
     [cdkDropListData]="group.studentsList"
     [cdkDropListConnectedTo]="connectedLists()"
     (cdkDropListDropped)="drop($event, group.key)">
                <h4>{{ group.nome }}</h4>
                <h2>{{ group.description }}</h2>
                @for(student of group.studentsList; track student.key) {
                  @if(student.firstName && student.lastName) {
                  <div class="drag-item" cdkDrag
                  [ngClass]="highlightstudent(student)"
                  [cdkDragData]="student"
                  >
                    {{ student.lastName }} {{ student.firstName }}
                  </div>
                }
                }
              </div>
            }
          </div>
        </div>
      </div>
      </div>
    </div>
  }

</div>
