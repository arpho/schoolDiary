<div class="upload-students-container">
  <div class="upload-container">
    <ion-input type="file" (change)="onFileChange($event)" accept=".xlsx, .xls"></ion-input>
  </div>
  <div class="list-container">
    @if (alunni().length > 0) {
      <ion-list>
        @for(alunno of alunni(); track $index) {
          <ion-item>
            @if(alunno && alunno.firstName && alunno.lastName) {
            <ion-card 
              (click)="fixName(alunno, $index)"
              [class.invalid-email]="!isEmailValid(emailFactory(alunno))"
            >
              <ion-card-header>
                <ion-card-title>{{alunno.lastName}}, {{alunno.firstName}}</ion-card-title>
                <ion-card-content>
                  <h2>{{emailFactory(alunno)}}</h2>
                  <h3>{{alunno.password}}</h3>
                </ion-card-content>
              </ion-card-header>
            </ion-card>
            }
          </ion-item>
        }
      </ion-list>

      @if (hasInvalidEmails()) {
        <ion-text color="danger" class="error-message">
          <p>Attenzione: Ci sono indirizzi email non validi. Correggi i seguenti indirizzi:</p>
          <ul>
            @for (email of invalidEmailsList(); track $index) {
              <li>{{ email }}</li>
            }
          </ul>
        </ion-text>
      }

      <ion-buttons slot="end">
        <ion-button 
          (click)="push()" 
          [disabled]="hasInvalidEmails()"
          [title]="hasInvalidEmails() ? 'Correggi gli indirizzi email non validi prima di procedere' : 'Salva gli studenti'"
        >
          <ion-icon name="push"></ion-icon>
        </ion-button>
      </ion-buttons>
    }
  </div>
</div>